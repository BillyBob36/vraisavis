import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

const cguContent = `# CONDITIONS GÉNÉRALES D'UTILISATION ET DE VENTE (CGU/CGV)
## Plateforme VraisAvis - Service SaaS pour Restaurateurs

**Version 1.0 - Applicable à compter du 1er janvier 2026**

---

## PRÉAMBULE

Les présentes Conditions Générales d'Utilisation et de Vente (ci-après « CGU/CGV ») régissent l'accès et l'utilisation de la plateforme VraisAvis (ci-après la « Plateforme »), éditée par :

**KAISER JOHANN (KAISER CO)**
Entrepreneur individuel (Micro-entreprise)
Siège social : 61 RUE DE LYON, 75012 PARIS
SIRET : 791 069 610 00032
N° TVA intracommunautaire : FR52791069610
Téléphone : +33 7 83 82 61 30
Email : contact@vraisavis.fr

Ci-après dénommée « **l'Éditeur** » ou « **VraisAvis** »

La Plateforme est accessible à l'adresse : https://vraisavis.fr

**Directeur de la publication :** KAISER JOHANN

**Hébergeur :**
Hetzner Online GmbH
Industriestr. 25, 91710 Gunzenhausen, Allemagne
https://www.hetzner.com

---

## ARTICLE 1 - DÉFINITIONS

**« Client »** : Tout professionnel de la restauration (personne physique ou morale) ayant souscrit un abonnement à la Plateforme.

**« Utilisateur Final »** : Toute personne physique cliente du restaurant du Client, utilisant le système de collecte d'avis via QR code.

**« Service »** : L'ensemble des fonctionnalités proposées par la Plateforme, incluant notamment la génération de QR codes, la collecte d'avis, l'accès à la console de gestion (dashboard), et les statistiques associées.

**« Abonnement »** : Contrat de souscription au Service pour une durée déterminée.

---

## ARTICLE 2 - OBJET

Les présentes CGU/CGV ont pour objet de définir les conditions dans lesquelles :
- Le Client peut accéder et utiliser la Plateforme
- L'Éditeur fournit le Service au Client
- Les droits et obligations de chaque partie sont établis

**L'acceptation des présentes CGU/CGV est obligatoire pour toute inscription et utilisation de la Plateforme.**

---

## ARTICLE 3 - DESCRIPTION DU SERVICE

### 3.1 Fonctionnalités incluses

L'abonnement à la Plateforme VraisAvis comprend :

- **QR Codes personnalisés** : Génération illimitée de QR codes à imprimer, permettant aux clients du restaurant de laisser un avis
- **Collecte d'avis** : Système de collecte d'avis clients avec notation et commentaires
- **Console Manager** : Accès à un tableau de bord complet permettant de :
  - Visualiser tous les avis reçus
  - Consulter les statistiques (note moyenne, évolution, etc.)
  - Gérer les informations du restaurant
  - Télécharger les QR codes
- **Support technique** : Assistance par email

### 3.2 Disponibilité du Service

L'Éditeur s'engage à fournir un Service disponible **99% du temps** sur une base mensuelle, hors :
- Opérations de maintenance programmées (notifiées 48h à l'avance)
- Cas de force majeure
- Dysfonctionnements liés à des tiers (hébergeur, FAI, etc.)

### 3.3 Évolutions du Service

L'Éditeur se réserve le droit de faire évoluer le Service (ajout, modification ou suppression de fonctionnalités) à tout moment, sous réserve d'en informer le Client par email au moins 15 jours à l'avance pour toute modification substantielle.

---

## ARTICLE 4 - CONDITIONS D'INSCRIPTION

### 4.1 Éligibilité

L'inscription à la Plateforme est réservée aux professionnels de la restauration :
- Personnes physiques majeures exerçant une activité de restauration
- Personnes morales dûment immatriculées

### 4.2 Processus d'inscription

Le Client doit :
1. Remplir le formulaire d'inscription avec des informations exactes et complètes
2. Accepter les présentes CGU/CGV en cochant la case prévue à cet effet
3. Valider son inscription

**Le Client garantit l'exactitude des informations fournies et s'engage à les maintenir à jour.**

### 4.3 Identifiants

Le Client est seul responsable de la confidentialité de ses identifiants de connexion. Toute utilisation de son compte est réputée effectuée par lui-même.

---

## ARTICLE 5 - TARIFICATION ET PAIEMENT

### 5.1 Prix de l'abonnement

Le prix de l'abonnement est fixé à **49€ HT par mois** (soit 58,80€ TTC au taux de TVA en vigueur de 20%).

Ce tarif est susceptible d'être révisé annuellement, avec un préavis de 30 jours avant la date anniversaire du contrat.

### 5.2 Durée d'engagement

**L'abonnement est souscrit pour une durée minimale de 12 (douze) mois.**

À l'issue de cette période initiale, l'abonnement est reconduit tacitement par périodes successives de 12 mois, sauf résiliation dans les conditions prévues à l'article 6.

### 5.3 Modalités de paiement

Le paiement s'effectue par **prélèvement automatique mensuel** sur le compte bancaire ou la carte bancaire du Client.

Le prélèvement est effectué le **5 de chaque mois** pour le mois en cours.

### 5.4 Retard de paiement

En cas de défaut de paiement à l'échéance :

- **Pénalités de retard** : Conformément à l'article L441-10 du Code de commerce, des pénalités de retard sont exigibles de plein droit, calculées sur la base de **trois fois le taux d'intérêt légal** en vigueur.

- **Indemnité forfaitaire** : Une indemnité forfaitaire de **40€** pour frais de recouvrement est due de plein droit (article D441-5 du Code de commerce).

- **Suspension du Service** : L'Éditeur se réserve le droit de suspendre l'accès au Service après une mise en demeure restée infructueuse pendant 15 jours.

### 5.5 Facturation

Une facture électronique est émise chaque mois et envoyée par email au Client. Les factures sont également disponibles dans la console Manager.

---

## ARTICLE 6 - DURÉE ET RÉSILIATION

### 6.1 Durée

Le contrat est conclu pour une durée initiale de **12 mois** à compter de la date d'inscription.

### 6.2 Résiliation par le Client

Le Client peut résilier son abonnement :

- **Pendant la période d'engagement** : La résiliation prend effet à la fin de la période d'engagement de 12 mois. Les mensualités restantes jusqu'à cette date restent dues.

- **Après la période d'engagement** : Le Client peut résilier à tout moment avec un préavis de **30 jours** avant la prochaine date anniversaire mensuelle.

La demande de résiliation doit être effectuée par email à contact@vraisavis.fr ou via la console Manager.

### 6.3 Résiliation par l'Éditeur

L'Éditeur peut résilier le contrat de plein droit, sans préavis ni indemnité, en cas de :
- Manquement grave du Client à ses obligations
- Non-paiement persistant malgré mise en demeure
- Utilisation frauduleuse ou abusive du Service
- Fourniture d'informations fausses lors de l'inscription

### 6.4 Effets de la résiliation

À la date effective de résiliation :
- L'accès au Service est désactivé
- Les données du Client sont conservées pendant 30 jours puis supprimées
- Les QR codes générés deviennent inactifs

**Aucun remboursement n'est dû pour la période en cours.**

---

## ARTICLE 7 - OBLIGATIONS DU CLIENT

Le Client s'engage à :

- Utiliser le Service conformément à sa destination et aux présentes CGU/CGV
- Ne pas utiliser le Service à des fins illicites ou contraires à l'ordre public
- Ne pas tenter de contourner les mesures de sécurité de la Plateforme
- Ne pas revendre ou sous-licencier l'accès au Service
- Respecter les droits de propriété intellectuelle de l'Éditeur
- Informer ses clients (Utilisateurs Finaux) de l'existence du système de collecte d'avis

---

## ARTICLE 8 - RESPONSABILITÉ DE L'ÉDITEUR

### 8.1 Limitation de responsabilité

**La responsabilité de l'Éditeur est limitée aux dommages directs et prévisibles, et ne pourra en aucun cas excéder le montant total des sommes versées par le Client au cours des 12 derniers mois.**

L'Éditeur ne saurait être tenu responsable :
- Des dommages indirects (perte de chiffre d'affaires, perte de clientèle, atteinte à l'image, etc.)
- Du contenu des avis laissés par les Utilisateurs Finaux
- Des interruptions de Service dues à des tiers ou à la force majeure
- De l'utilisation frauduleuse des identifiants du Client

### 8.2 Force majeure

L'Éditeur ne saurait être tenu responsable de l'inexécution de ses obligations en cas de force majeure au sens de l'article 1218 du Code civil.

### 8.3 Garanties

L'Éditeur garantit que le Service est conforme à sa description et exempt de vices cachés. **Aucune autre garantie, expresse ou implicite, n'est accordée.**

---

## ARTICLE 9 - PROPRIÉTÉ INTELLECTUELLE

### 9.1 Droits de l'Éditeur

La Plateforme, son architecture, son code source, ses bases de données, ses interfaces, ses contenus et sa marque sont la propriété exclusive de l'Éditeur.

Toute reproduction, représentation, modification ou exploitation non autorisée est interdite et constitue une contrefaçon sanctionnée par le Code de la propriété intellectuelle.

### 9.2 Licence d'utilisation

L'Éditeur concède au Client une licence d'utilisation non exclusive, non transférable et non cessible du Service, pour la durée de l'abonnement et pour ses seuls besoins professionnels.

### 9.3 Données du Client

Le Client reste propriétaire des données qu'il saisit sur la Plateforme (informations du restaurant, etc.).

---

## ARTICLE 10 - PROTECTION DES DONNÉES PERSONNELLES

### 10.1 Responsable de traitement

L'Éditeur agit en qualité de **responsable de traitement** pour les données des Clients et de **sous-traitant** pour les données des Utilisateurs Finaux collectées via le système d'avis.

### 10.2 Données collectées

**Données des Clients :**
- Identité et coordonnées (nom, email, téléphone)
- Informations du restaurant (nom, adresse, coordonnées GPS)
- Données de facturation

**Données des Utilisateurs Finaux :**
- Avis et commentaires (texte libre)
- Empreinte numérique du navigateur (fingerprint) - données pseudonymisées
- Localisation approximative au moment de l'avis
- Date et heure de l'avis

### 10.3 Finalités du traitement

Les données sont traitées pour :
- Fournir le Service au Client
- Gérer la relation commerciale et la facturation
- Détecter et prévenir les avis frauduleux (fingerprint, localisation)
- Améliorer le Service
- Respecter les obligations légales

### 10.4 Durée de conservation

- **Données des Clients** : Durée du contrat + 5 ans (prescription légale)
- **Données des Utilisateurs Finaux** :
  - Avis : Durée du contrat du Client + 1 an
  - Fingerprints et localisation : **13 mois maximum** (conformément aux recommandations de la CNIL)

### 10.5 Destinataires des données

Les données peuvent être communiquées à :
- L'hébergeur (Hetzner) pour le stockage
- Les prestataires de paiement pour la facturation
- Les autorités compétentes sur réquisition légale

**Aucune donnée n'est vendue ou cédée à des tiers à des fins commerciales.**

### 10.6 Droits des personnes

Conformément au RGPD, toute personne dispose des droits suivants :
- Droit d'accès, de rectification et d'effacement
- Droit à la limitation du traitement
- Droit à la portabilité des données
- Droit d'opposition

Ces droits peuvent être exercés par email à : contact@vraisavis.fr

### 10.7 Sécurité

L'Éditeur met en œuvre des mesures techniques et organisationnelles appropriées pour protéger les données :
- Chiffrement des données en transit (HTTPS/TLS)
- Accès restreint aux données
- Sauvegardes régulières
- Hébergement sécurisé en Union Européenne

---

## ARTICLE 11 - COOKIES

La Plateforme utilise des cookies techniques nécessaires au fonctionnement du Service. Pour plus d'informations, consultez notre Politique de Cookies accessible sur le site.

---

## ARTICLE 12 - MÉDIATION

Conformément aux articles L611-1 et suivants du Code de la consommation, en cas de litige, le Client professionnel peut recourir gratuitement au service de médiation suivant :

**CNPM - MÉDIATION DE LA CONSOMMATION**
27 avenue de la Libération, 42400 Saint-Chamond
https://cnpm-mediation-consommation.eu

Le recours à la médiation n'est possible qu'après avoir préalablement tenté de résoudre le litige directement avec l'Éditeur.

---

## ARTICLE 13 - DROIT APPLICABLE ET JURIDICTION

Les présentes CGU/CGV sont soumises au **droit français**.

En cas de litige, et après échec de toute tentative de résolution amiable, compétence exclusive est attribuée aux **Tribunaux compétents de Paris**, nonobstant pluralité de défendeurs ou appel en garantie.

---

## ARTICLE 14 - DISPOSITIONS GÉNÉRALES

### 14.1 Intégralité

Les présentes CGU/CGV constituent l'intégralité de l'accord entre les parties et remplacent tout accord antérieur.

### 14.2 Nullité partielle

Si une clause des présentes CGU/CGV était déclarée nulle, les autres clauses conserveraient leur pleine validité.

### 14.3 Tolérance

Le fait pour l'Éditeur de ne pas se prévaloir d'un manquement du Client ne saurait valoir renonciation à s'en prévaloir ultérieurement.

### 14.4 Modification des CGU/CGV

L'Éditeur se réserve le droit de modifier les présentes CGU/CGV. Les modifications seront notifiées au Client par email au moins 30 jours avant leur entrée en vigueur. L'utilisation continue du Service après cette date vaut acceptation des nouvelles conditions.

---

**En cochant la case "J'ai lu et j'accepte les CGU/CGV", le Client reconnaît avoir pris connaissance des présentes conditions et les accepter sans réserve.**

---

*Dernière mise à jour : 1er janvier 2026*

*KAISER JOHANN (KAISER CO) - Tous droits réservés*`;

async function main() {
  console.log('Création du template CGU/CGV pour restaurants...');

  const existingTemplate = await prisma.contractTemplate.findFirst({
    where: { type: 'CGU_CGV', isActive: true },
  });

  if (existingTemplate) {
    console.log('Un template CGU/CGV actif existe déjà, mise à jour...');
    await prisma.contractTemplate.update({
      where: { id: existingTemplate.id },
      data: {
        version: '1.0',
        companyName: 'KAISER JOHANN (KAISER CO)',
        companyLegalForm: 'Entrepreneur individuel (Micro-entreprise)',
        companyCapital: 'Non applicable (EI)',
        companyAddress: '61 RUE DE LYON, 75012 PARIS',
        companyRCS: 'Non inscrit au RCS (Entrepreneur individuel)',
        companySIRET: '791 069 610 00032',
        companyVAT: 'FR52791069610',
        companyPhone: '+33 7 83 82 61 30',
        companyEmail: 'contact@vraisavis.fr',
        companyDirector: 'KAISER JOHANN',
        hostingProvider: 'Hetzner Online GmbH',
        hostingAddress: 'Industriestr. 25, 91710 Gunzenhausen, Allemagne',
        mediatorName: 'CNPM - MÉDIATION DE LA CONSOMMATION',
        mediatorAddress: '27 avenue de la Libération, 42400 Saint-Chamond',
        mediatorWebsite: 'https://cnpm-mediation-consommation.eu',
        jurisdiction: 'Tribunaux compétents de Paris',
        monthlyPrice: 4900,
        contractContent: cguContent,
      },
    });
    console.log('Template CGU/CGV mis à jour !');
  } else {
    await prisma.contractTemplate.create({
      data: {
        type: 'CGU_CGV',
        version: '1.0',
        companyName: 'KAISER JOHANN (KAISER CO)',
        companyLegalForm: 'Entrepreneur individuel (Micro-entreprise)',
        companyCapital: 'Non applicable (EI)',
        companyAddress: '61 RUE DE LYON, 75012 PARIS',
        companyRCS: 'Non inscrit au RCS (Entrepreneur individuel)',
        companySIRET: '791 069 610 00032',
        companyVAT: 'FR52791069610',
        companyPhone: '+33 7 83 82 61 30',
        companyEmail: 'contact@vraisavis.fr',
        companyDirector: 'KAISER JOHANN',
        hostingProvider: 'Hetzner Online GmbH',
        hostingAddress: 'Industriestr. 25, 91710 Gunzenhausen, Allemagne',
        mediatorName: 'CNPM - MÉDIATION DE LA CONSOMMATION',
        mediatorAddress: '27 avenue de la Libération, 42400 Saint-Chamond',
        mediatorWebsite: 'https://cnpm-mediation-consommation.eu',
        jurisdiction: 'Tribunaux compétents de Paris',
        monthlyPrice: 4900,
        contractContent: cguContent,
        isActive: true,
      },
    });
    console.log('Template CGU/CGV créé !');
  }
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
